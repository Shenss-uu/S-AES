# S-AES 加密系统

## 项目简介

S-AES（Simplified Advanced Encryption Standard）的完整实现，包含所有扩展功能和图形用户界面。使用16位数据块和16位密钥，是AES算法的教学简化版本。

## 功能实现

| 关卡 | 功能 | 实现状态 |
|------|------|---------|
| 第1关 | 基本加解密（16位） | ✅ |
| 第2关 | 交叉测试支持 | ✅ |
| 第3关 | ASCII字符串加解密 | ✅ |
| 第4.1关 | 双重加密（32位密钥） | ✅ |
| 第4.2关 | 中间相遇攻击 | ✅ |
| 第4.3关 | 三重加密（32/48位密钥） | ✅ |
| 第5关 | CBC模式 + 篡改检测 | ✅ |

## 核心算法原理

### S-AES基本算法

**数据结构**：
- 数据块：16位（4个半字节）
- 密钥长度：16位
- 轮数：2轮

**加密流程**：
```
输入：16位明文P，16位密钥K

1. 密钥扩展：生成K0, K1, K2三个轮密钥
2. 第0轮：State = P ⊕ K0
3. 第1轮（完整轮）：
   - 半字节替换（SubNibbles）
   - 行移位（ShiftRows）
   - 列混淆（MixColumns）
   - 轮密钥加（AddRoundKey with K1）
4. 第2轮（最终轮，无列混淆）：
   - 半字节替换
   - 行移位
   - 轮密钥加（AddRoundKey with K2）

输出：16位密文C
```

**解密流程**：加密的逆过程，操作顺序相反。

### S盒（Substitution Box）

4×4的非线性替换表，提供算法的混淆特性：

```
正向S盒：
     0  1  2  3
   +--+--+--+--+
 0 | 9  4  A  B |
 1 | D  1  8  5 |
 2 | 6  2  0  3 |
 3 | C  E  F  7 |
   +--+--+--+--+

逆向S盒：
     0  1  2  3
   +--+--+--+--+
 0 | A  5  9  B |
 1 | 1  7  8  F |
 2 | 6  0  2  3 |
 3 | C  4  D  E |
   +--+--+--+--+
```

### 列混淆（Mix Columns）

在GF(2^4)有限域上进行矩阵乘法，提供算法的扩散特性：

```
正向矩阵：        逆向矩阵：
[1  4]            [9  2]
[4  1]            [2  9]

不可约多项式：x^4 + x + 1
```

**状态变换**：
```
[s00 s01]   [1 4]   [s00 s01]
[s10 s11] × [4 1] = [s10 s11]

新值 = 矩阵乘法的结果（在GF(2^4)域上）
```

### 密钥扩展算法

从16位主密钥生成3个轮密钥：

```
输入：K = w0 || w1（每个w为8位）

计算过程：
w2 = w0 ⊕ g(w1)，其中g(w) = RCON[1] ⊕ SubNib(RotNib(w))
w3 = w2 ⊕ w1
w4 = w2 ⊕ g(w3)，其中g(w) = RCON[2] ⊕ SubNib(RotNib(w))
w5 = w4 ⊕ w3

轮密钥：
K0 = w0 || w1
K1 = w2 || w3
K2 = w4 || w5

轮常量：RCON[1] = 0x80, RCON[2] = 0x30
```

**关键操作**：
- RotNib：半字节循环移位（交换高低半字节）
- SubNib：应用S盒替换

## 扩展功能原理

### 1. ASCII字符串加解密

**原理**：
- 将字符串编码为UTF-8字节流
- 按2字节（16位）分组
- 每组独立使用S-AES加密
- 奇数长度自动填充0

**特点**：
- 支持任意长度文本
- 支持多语言（UTF-8编码）
- 独立分组加密（ECB模式）

### 2. 双重加密

**算法**：`C = E_K2(E_K1(P))`

**特点**：
- 使用两个16位密钥K1和K2
- 总密钥长度：32位
- 密钥空间：2^32 ≈ 43亿

**安全性**：
- 理论上应提供2倍安全性
- 实际上易受中间相遇攻击
- 有效安全强度约为2^17而非2^32

### 3. 中间相遇攻击（Meet-in-the-Middle Attack）

**攻击原理**：
```
已知：明文P，密文C
目标：找到K1和K2，使得C = E_K2(E_K1(P))

方法：
1. 构建中间值表：
   对所有可能的K1，计算M = E_K1(P)，存储(M → K1)映射
   
2. 查找匹配：
   对所有可能的K2，计算M' = D_K2(C)
   如果M'在表中，则(K1, K2)是候选密钥对
```

**复杂度分析**：
- 时间复杂度：O(2^17) ≈ 131,072次操作
- 空间复杂度：O(2^16) ≈ 65,536个条目
- 实际运行时间：3-5秒

**意义**：展示双重加密并不能简单地平方密钥空间。

### 4. 三重加密

#### 模式1：32位密钥（EDE模式）

**算法**：`C = E_K1(D_K2(E_K1(P)))`

**特点**：
- 使用两个密钥，K1使用两次
- 向后兼容：当K1=K2时退化为单次加密
- 抵抗中间相遇攻击

#### 模式2：48位密钥（三密钥模式）

**算法**：`C = E_K3(D_K2(E_K1(P)))`

**特点**：
- 使用三个独立密钥
- 密钥空间：2^48 ≈ 281万亿
- 最高安全性

### 5. CBC工作模式（密码分组链）

**加密算法**：
```
C_i = E_K(P_i ⊕ C_{i-1})
C_0 = IV（初始向量）
```

**解密算法**：
```
P_i = D_K(C_i) ⊕ C_{i-1}
C_0 = IV
```

**关键特性**：
1. **链接性**：每个密文块依赖前一个密文块
2. **随机化**：相同明文块产生不同密文（通过IV）
3. **错误传播**：C_i的错误影响P_i和P_{i+1}
4. **篡改检测**：修改密文会导致解密结果错误

**初始向量（IV）**：
- 长度：16位
- 要求：每次加密使用不同的随机IV
- 作用：防止模式分析攻击

## 交叉测试向量

用于验证不同实现的兼容性：

| 明文(P) | 密钥(K) | 密文(C) |
|---------|---------|---------|
| 0000 | 0000 | 37B4 |
| FFFF | FFFF | 5555 |
| 1234 | 5678 | 0A20 |
| 1234 | 2D55 | 07B3 |
| ABCD | 1234 | 1043 |

## 安全性分析

### 密钥空间对比

| 加密方式 | 密钥长度 | 理论密钥空间 | 有效安全强度 |
|---------|---------|------------|------------|
| 单重S-AES | 16位 | 2^16 | 2^16（极弱） |
| 双重S-AES | 32位 | 2^32 | 2^17（易受MITM攻击） |
| 三重S-AES（32位） | 32位 | 2^32 | 2^32（中等） |
| 三重S-AES（48位） | 48位 | 2^48 | 2^48（较强） |

### 攻击方法

**1. 暴力破解**
- 单重：平均尝试2^15次
- 双重：平均尝试2^31次

**2. 中间相遇攻击**
- 针对双重加密
- 时间复杂度：O(2^17)
- 空间复杂度：O(2^16)

**3. CBC模式分析**
- 固定IV可被检测
- 密文篡改可被发现
- 错误传播限制在2个块

